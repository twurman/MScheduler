{% extends "base.html" %}

{% block content %}

<h1> Welcome to the University of Michigan Web Scheduler! </h1>

<div id="accordion">
    <div class="panel">
      <div class="pink"></div>
      <div class="panelContent p1"> <strong>Select A Term</strong><br></br>
        {% for term in terms %}
			<div class="TermItem SelTerm" name="{{term['TermCode']}}" <a href="{{term['TermCode']}}">{{ term['TermDescr'] }}</a>
			</div>
		    <br>
		{% endfor %}
      </div>
    </div>
    <div class="panel">
      <div class="pink dark1"></div>
      <div id="Schools" class="panelContent p2"> <strong>Select School</strong><br><br/>
        {% for term in terms %}
			<div class="TermItem SelTerm" name="{{term['TermCode']}}" <a href="{{term['TermCode']}}">{{ term['TermDescr'] }}</a>
			</div>
		    <br>
		{% endfor %}
      </div>
    </div>
    <div class="panel">
      <div class="pink dark2"></div>
      <div class="panelContent p3"> <strong>Select Subject</strong><br><br/>
        {% for term in terms %}
			<div class="TermItem SelSubject" <a href="{{term['TermCode']}}">{{ term['TermDescr'] }}</a>
			</div>
		    <br>
		{% endfor %}
      </div>
    </div>
    <div class="panel FinalStage">
      <div class="pink dark3"></div>
      <div class="panelContent p4"> <strong>Select Class</strong><br><br/>
        {% for term in terms %}
			<div class="TermItem SelClass" <a href="/schools/{{term['TermCode']}}">{{ term['TermDescr'] }}</a>
			</div>
		    <br>
		{% endfor %}
      </div>
    </div>
</div>

<script>
$(document).ready(function(){
 
    activePanel = $("#accordion div.panel:first");
    $(activePanel).addClass('active');

    termChoice = $("accordion .TermItem:first");
 
    $("#accordion").delegate('.TermItem', 'click', function(e){
    	panelToActivate = $(this).parent('.panelContent').parent('.panel').nextAll('.panel:first');
    	currentPanel = $(this).parent('.panelContent').parent('.panel');
    	termChoice = $(this);

    	currentPanel.find('.TermItem').removeClass('active');
    	currentPanel.nextAll('.panel').find('.TermItem').removeClass('active');
    	termChoice.addClass('active');


    	//Ajax requests
    	if( termChoice.hasClass('SelTerm') )
    	{
    		var url = $SCRIPT_ROOT + "/schools/" + termChoice.attr('name');
    		$.getJSON( url, function( jsonData ) {
			  var items = [];
			  $.each( jsonData, function( key, val ) {
			    items.push( "<li id='" + key + "'>" + val + "</li>" );
			  });
			 
			  $( "#Schools").append( items );

			});

    	}
    	else if( termChoice.hasClass('SelSchool') )
    	{

    	}

        if( !currentPanel.hasClass('FinalStage') && !$(panelToActivate).is('.active') ){

        	numMorePanels = $(panelToActivate).nextAll('.panel').length;

        	//animate all previous panels to normal width
			$(panelToActivate).prevAll('.panel').animate({width: "16%"}, 300);
			//animate all the rest of the panels (ones that come after) to small width
			$(panelToActivate).nextAll('.panel').animate({width: "4%"}, 300);
			//animate the main panel to full size for selection
			$(panelToActivate).animate({width: "52%"}, 300);

			for(i = 0; i < numMorePanels; i++)
			{
				$(panelToActivate).animate({width: "+=11.66%"}, 50);
			}
			//no longer active
			$('#accordion .panel').removeClass('active');
			//set active to the selection
			$(panelToActivate).addClass('active');
			//(Depricated)
			activePanel = $(panelToActivate);
		 };
    });
});
</script>

{% if api_error %}
<b>Getting the API terms failed!</b>
Did you set the API token?
{% endif %}

{% endblock %}