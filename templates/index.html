{% extends "base.html" %}

{% block content %}

<h1> Welcome to the University of Michigan Web Scheduler! </h1>

<div id="accordion">
    <div class="panel">
      <div class="pink"></div>
      <div class="panelContent p1"> <strong>Select A Term</strong><br></br>
        {% for term in terms %}
            <div class="TermItem SelTerm" name="{{term['TermCode']}}" <a href="{{term['TermCode']}}">{{ term['TermDescr'] }}</a>
            </div>
            <br>
        {% endfor %}
      </div>
    </div>
    <div class="panel">
      <div class="pink dark1"></div>
      <div id="Schools" class="panelContent p2"> <strong>Select School</strong><br><br/>
      </div>
    </div>
    <div class="panel">
      <div class="pink dark2"></div>
      <div id="Subjects" class="panelContent p3"> <strong>Select Subject</strong><br><br/>
      </div>
    </div>
    <div class="panel FinalStage">
      <div class="pink dark3"></div>
      <div id="Classes" class="panelContent p4"> <strong>Select Class</strong><br><br/>
      </div>
    </div>
</div>

<script>
$(document).ready(function(){

    activePanel = $("#accordion div.panel:first");
    $(activePanel).addClass('active');

    termChoice = $("accordion .TermItem:first");
    termCode = 0;
    schoolCode = 0;
    subjectCode = 0;

    $("#accordion").delegate('.TermItem', 'click', function(e){
        panelToActivate = $(this).parent('.panelContent').parent('.panel').nextAll('.panel:first');
        currentPanel = $(this).parent('.panelContent').parent('.panel');
        termChoice = $(this);

        currentPanel.find('.TermItem').removeClass('active');
        currentPanel.nextAll('.panel').find('.TermItem').removeClass('active');
        termChoice.addClass('active');


        //Ajax requests
        if( termChoice.hasClass('SelTerm') )
        {
        	termCode = termChoice.attr('name');
        	$( "#Schools").empty();
            var url = "{{ config['api_url'] }}/get_schools?term_code=" + termChoice.attr('name');
            $.getJSON( url, function( jsonData ) {
                var items = [];
                $.each( jsonData, function( key, obj ) {
                    //items.push( "<li id='" + obj.SchoolCode + "'>" + obj.SchoolDescr + "</li>" );
                    items.push( "<div class='TermItem SelSchool' name='" + obj.SchoolCode + "' <p>" + obj.SchoolDescr + " </p></div>"  );
                });

                $( "#Schools").append("<strong> Select School </strong><br><br/>");
                $( "#Schools").append( items );
            });

        }
        else if( termChoice.hasClass('SelSchool') )
        {
        	schoolCode = termChoice.attr('name');
        	$( "#Subjects").empty();
        	var url = "{{ config['api_url'] }}/get_subjects?term_code=" + termCode + "&school=" + schoolCode;
            $.getJSON( url, function( jsonData ) {
                var items = [];
                $.each( jsonData, function( key, obj ) {
                    //items.push( "<li id='" + obj.SchoolCode + "'>" + obj.SchoolDescr + "</li>" );
                    items.push( "<div class='TermItem SelSubject' name='" + obj.SubjectCode + "' <p> (" + obj.SubjectShortDescr + ")" + obj.SubjectDescr + " </p></div>"  );
                });

                $( "#Subjects").append("<strong> Select Subject </strong><br><br/>");
                $( "#Subjects").append( items );
            });

        }
        else if( termChoice.hasClass('SelSubject') )
        {
        	subjectCode = termChoice.attr('name');
        	$( "#Classes").empty();
        	var url = "{{ config['api_url'] }}/get_catalog_numbers?term_code=" + termCode + "&school=" + schoolCode + "&subject=" + subjectCode;
            $.getJSON( url, function( jsonData ) {
                var items = [];
                $.each( jsonData, function( key, obj ) {
                    //items.push( "<li id='" + obj.SchoolCode + "'>" + obj.SchoolDescr + "</li>" );
                    items.push( "<div class='TermItem SelClass' name='" + obj.CatalogNumber + "' <p> (" + obj.CatalogNumber + ")" + obj.CourseDescr + " </p></div>"  );
                });

                $( "#Classes").append("<strong> Select Subject </strong><br><br/>");
                $( "#Classes").append( items );
            });
        }

        if( !currentPanel.hasClass('FinalStage') && !$(panelToActivate).is('.active') ){

            numMorePanels = $(panelToActivate).nextAll('.panel').length;

            //animate all previous panels to normal width
            $(panelToActivate).prevAll('.panel').animate({width: "16%"}, 300);
            //animate all the rest of the panels (ones that come after) to small width
            $(panelToActivate).nextAll('.panel').animate({width: "4%"}, 300);
            //animate the main panel to full size for selection
            $(panelToActivate).animate({width: "52%"}, 300);

            for(i = 0; i < numMorePanels; i++)
            {
                $(panelToActivate).animate({width: "+=11.66%"}, 50);
            }
            //no longer active
            $('#accordion .panel').removeClass('active');
            //set active to the selection
            $(panelToActivate).addClass('active');
            //(Depricated)
            activePanel = $(panelToActivate);
         };
    });
});
</script>


{% endblock %}