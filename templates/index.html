{% extends "base.html" %}

{% block content %}

<h1 style="text-align: center; color: white"> Welcome to the University of Michigan Web Scheduler! </h1>

<div id="accordion">
    <div class="panel">
      <div class="pink"></div>
      <div class="panelContent p1">
      	<div id="TermSelHeader" class="SelHeader"><strong> Select Term </strong></div><br><br/>
      	<div id="TermSelHolder" class="TermHolder"> 
        {% for term in terms %}
            <div class="TermItem SelTerm" name="{{term['TermCode']}}" <a href="{{term['TermCode']}}">{{ term['TermDescr'] }}</a></div>
            <br>
        {% endfor %}
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="pink dark1"></div>
      <div id="Schools" class="panelContent p2">
      		<div id="SchoolHeader" class="SelHeader"><!-- <strong> Select School </strong> --></div><br><br/>
      		<div id="SchoolHolder" class="TermHolder"></div>
      </div>
    </div>
    <div class="panel">
      <div class="pink dark2"></div>
      <div id="Subjects" class="panelContent p3">
      		<div id="SubjectHeader" class="SelHeader"><!-- <strong> Select Subject </strong> --></div><br><br/>
      		<div id="SubjectHolder" class="TermHolder"></div>
      </div>
    </div>

    <div class="panel">
      <div class="pink dark3"></div>
      <div id="Classes" class="panelContent p4">
      		<div id="ClassHeader" class="SelHeader"><!-- <strong> Select Class </strong> --></div><br><br/>
      		<div id="ClassHolder" class="TermHolder"></div>
      </div>
    </div>

    <div class="panel FinalStage">
      <div class="pink dark4"></div>
      <div id="Button" class="panelContent p5">
        <div id="ButtonHeader" class="SelHeader"></div><br><br/>
        <div id="ButtonHolder" class="TermHolder"></div>
      </div>
    </div>
</div>

<div class="panel2" id="Viewer">
  <div class = "pink dark3"></div>
  <div id="ViewInfo" class="panel1Content">

  </div>
</div>

<div class="container">
  <!-- <div class="backpack"> -->
    <table class="table table-striped" style="background-color:white; border-radius:5px; align:center">
      <thead>
        <th width="80%">Course</th>
        <th width="10%">Edit</th>
        <th width="10%">Delete</th>
      </thead>
      <tbody>
        {% for course in backpack %}
            <tr>
              <td>{{ course['subject'] }} {{ course['course_num'] }}</td>
              <td><button type="button" class="btn btn-warning">Edit</button></td>
              <td><button type="button" class="btn btn-danger">Delete</button></td>
            </tr>
        {% endfor %}
      </tbody>
    </table>
  <!-- </div> -->
</div>
<br>

<div id='calendarHolder'>
  <div id='calendar1' class="calendar"></div>
  <div id='calendar2' class="calendar"></div>
</div>

<script>
function refreshCals(){

  $( "#calendarHolder").empty();

  var url = "/get_schedules";
  $.getJSON( url, function( jsonData ) 
  {
      var items = [];
      var i = 0;
      $.each( jsonData, function( key, obj ) {

        //create new calendar div
        $( "#calendarHolder").append( "<div id='calendar" + i + "' class='calendar'</div>" );

        //create calendar for this div
        var calendar = $('#calendar' + i).fullCalendar(
        {
          header:false,
          defaultView: 'agendaWeek',
          selectable: true,
          selectHelper: true,
          editable: false,
          allDaySlot:false,
          weekends:false,
          columnFormat: 'ddd',
          minTime: "08:30:00",
          maxTime: "18:30:00",
          events:obj
        });

        console.log(obj);

        //increment i
        i = i+1;
      });
  });
}



$(document).ready(function(){

  var date = new Date();
  var d = date.getDate();
  var m = date.getMonth();
  var y = date.getFullYear();

  refreshCals();
    activePanel = $("#accordion div.panel:first");
    $(activePanel).addClass('active');

    termChoice = $("accordion .TermItem:first");
    termCode = 0;
    schoolCode = 0;
    subjectCode = 0;
    courseCode = 0;

    $("#accordion").delegate('.TermItem', 'click', function(e){

        currentPanel = $(this).parent('.TermHolder').parent('.panelContent').parent('.panel');
        panelToActivate = currentPanel.nextAll('.panel:first');
        termChoice = $(this);

        currentPanel.find('.TermItem').removeClass('active');
        currentPanel.nextAll('.panel').find('.TermItem').removeClass('active');
        termChoice.addClass('active');


        //Ajax requests
        if( termChoice.hasClass('SelTerm') )
        {
            $( "#SchoolHeader").empty();
            $( "#SubjectHolder").empty();
            $( "#ClassHolder").empty();
            $( "#SubjectHeader").empty();
            $( "#ClassHeader").empty();
            $( "#SchoolHeader").append("<strong> Select School </strong>");

        	termCode = termChoice.attr('name');
        	$( "#SchoolHolder").empty();
            var url = "{{ config['api_url'] }}/get_schools?term_code=" + termChoice.attr('name');
            $.getJSON( url, function( jsonData ) {
                var items = [];
                $.each( jsonData, function( key, obj ) {
                    //items.push( "<li id='" + obj.SchoolCode + "'>" + obj.SchoolDescr + "</li>" );
                    items.push( "<div class='TermItem SelSchool' name='" + obj.SchoolCode + "' <p>" + obj.SchoolDescr + " </p></div>"  );
                });

                //$( "#SchoolHolder").append("<strong> Select School </strong><br><br/>");
                $( "#SchoolHolder").append( items );
            });

        } else if( termChoice.hasClass('SelSchool') ) {
            $( "#SubjectHeader").empty();
            $( "#ClassHeader").empty();
            $( "#ClassHolder").empty();
            $( "#SubjectHeader").append("<strong> Select Subject </strong>");

        	schoolCode = termChoice.attr('name');
        	$( "#SubjectHolder").empty();
        	var url = "{{ config['api_url'] }}/get_subjects?term_code=" + termCode + "&school=" + schoolCode;
            $.getJSON( url, function( jsonData ) {
                var items = [];
                $.each( jsonData, function( key, obj ) {
                    //items.push( "<li id='" + obj.SchoolCode + "'>" + obj.SchoolDescr + "</li>" );
                    items.push( "<div class='TermItem SelSubject' name='" + obj.SubjectCode + "' <p> (" + obj.SubjectShortDescr + ") " + obj.SubjectDescr + " </p></div>"  );
                });

                $( "#SubjectHolder").append( items );
            });

        } else if( termChoice.hasClass('SelSubject') ) {
            $( "#ClassHeader").empty();
            $( "#ClassHeader").append("<strong> Select Class </strong>");

        	subjectCode = termChoice.attr('name');
        	$( "#ClassHolder").empty();
        	var url = "{{ config['api_url'] }}/get_catalog_numbers?term_code=" + termCode + "&school=" + schoolCode + "&subject=" + subjectCode;
            $.getJSON( url, function( jsonData ) {
                var items = [];
                $.each( jsonData, function( key, obj ) {
                    //items.push( "<li id='" + obj.SchoolCode + "'>" + obj.SchoolDescr + "</li>" );
                    items.push( "<div class='TermItem SelClass' name='" + obj.CatalogNumber + "' <p> (" + obj.CatalogNumber + ") " + obj.CourseDescr + " </p></div>"  );
                });

                $( "#ClassHolder").append( items );

                if( items.length <= 0 )
                {
                	$( "#ClassHolder").append( "<p> This subject has no classes this term :( </p>" );
                }
            });
        }

        $( "#ButtonHolder").empty();
        if( termChoice.hasClass('SelClass') )
        {
            courseCode = termChoice.attr('name');
            $( "#ButtonHolder").append( "<br><br><div style='text-align:center' class='col-sm-8 col-sm-offset-2'><button class='btn btn-primary btn-large btn-block' type='button' id='viewInfo'> View Info </button><br><br/> <button class='btn btn-primary btn-large btn-block' id='addClass'> Add Class </button></div>");

            // @app.route('/backpack_course/<term>/<school>/<subject>/<course_num>')
            var url='/backpack_course/' + termCode + '/' + schoolCode + '/' + subjectCode + '/' + courseCode;
            $('#addClass').bind('click', function(){
                $.getJSON(url, function(){});
                alert("Class Added!");
            });

            $('#viewInfo').bind('click', function(){
              alert("ViewClass")
            });
        }


        if( !currentPanel.hasClass('FinalStage') && !$(panelToActivate).is('.active')    ){

            numMorePanels = $(panelToActivate).nextAll('.panel').length;

            if ( $(panelToActivate).hasClass('FinalStage') )
            {
            	//animate all previous panels to normal width
	            $(panelToActivate).prevAll('.panel').animate({width: "15%"}, 300);
	            $(panelToActivate).prev('.panel').animate({width: "25%"}, 120);

	            //animate the main panel to full size for selection
	            $(panelToActivate).animate({width: "30%"}, 300);
            }
            else
            {

	            //animate all previous panels to normal width
	            $(panelToActivate).prevAll('.panel').animate({width: "15%"}, 300);


	            //animate all the rest of the panels (ones that come after) to small width
	            $(panelToActivate).nextAll('.panel').animate({width: "5%"}, 300);
	            //animate the main panel to full size for selection
	            $(panelToActivate).animate({width: "39.9%"}, 300);

	            for(i = 0; i < numMorePanels; i++)
	            {
	                $(panelToActivate).animate({width: "+=10%"}, 120);
	            }
	        }
          //no longer active
          $('#accordion .panel').removeClass('active');
          //set active to the selection
          $(panelToActivate).addClass('active');
          //(Depricated)
          activePanel = $(panelToActivate);
        };
    });
});
</script>


{% endblock %}