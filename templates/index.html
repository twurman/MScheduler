{% extends "base.html" %}

{% block content %}

<h1 style="text-align: center"> Welcome to the University of Michigan Web Scheduler! </h1>
<br><br>

<div id="accordion">
    <div class="panel">
      <div class="pink"></div>
      <div class="panelContent p1">
      	<div id="TermSelHeader" class="SelHeader"><strong> Select Term </strong></div><br><br/>
      	<div id="TermSelHolder" class="TermHolder"> 
        {% for term in terms %}
            <div class="TermItem SelTerm" name="{{term['TermCode']}}" <a href="{{term['TermCode']}}">{{ term['TermDescr'] }}</a></div>
            <br>
        {% endfor %}
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="pink dark1"></div>
      <div id="Schools" class="panelContent p2">
      		<div id="SchoolHeader" class="SelHeader"><!-- <strong> Select School </strong> --></div><br><br/>
      		<div id="SchoolHolder" class="TermHolder"></div>
      </div>
    </div>
    <div class="panel">
      <div class="pink dark2"></div>
      <div id="Subjects" class="panelContent p3">
      		<div id="SubjectHeader" class="SelHeader"><!-- <strong> Select Subject </strong> --></div><br><br/>
      		<div id="SubjectHolder" class="TermHolder"></div>
      </div>
    </div>
    <div class="panel FinalStage">
      <div class="pink dark3"></div>
      <div id="Classes" class="panelContent p4">
      		<div id="ClassHeader" class="SelHeader"><!-- <strong> Select Class </strong> --></div><br><br/>
      		<div id="ClassHolder" class="TermHolder"></div>
      </div>
    </div>
</div>

<script>
$(document).ready(function(){

    activePanel = $("#accordion div.panel:first");
    $(activePanel).addClass('active');

    termChoice = $("accordion .TermItem:first");
    termCode = 0;
    schoolCode = 0;
    subjectCode = 0;

    $("#accordion").delegate('.TermItem', 'click', function(e){

        currentPanel = $(this).parent('.TermHolder').parent('.panelContent').parent('.panel');
        panelToActivate = currentPanel.nextAll('.panel:first');
        termChoice = $(this);

        currentPanel.find('.TermItem').removeClass('active');
        currentPanel.nextAll('.panel').find('.TermItem').removeClass('active');
        termChoice.addClass('active');


        //Ajax requests
        if( termChoice.hasClass('SelTerm') )
        {
            $( "#SchoolHeader").empty();
            $( "#SchoolHeader").append("<strong> Select School </strong>");

        	termCode = termChoice.attr('name');
        	$( "#SchoolHolder").empty();
            var url = "{{ config['api_url'] }}/get_schools?term_code=" + termChoice.attr('name');
            $.getJSON( url, function( jsonData ) {
                var items = [];
                $.each( jsonData, function( key, obj ) {
                    //items.push( "<li id='" + obj.SchoolCode + "'>" + obj.SchoolDescr + "</li>" );
                    items.push( "<div class='TermItem SelSchool' name='" + obj.SchoolCode + "' <p>" + obj.SchoolDescr + " </p></div>"  );
                });

                //$( "#SchoolHolder").append("<strong> Select School </strong><br><br/>");
                $( "#SchoolHolder").append( items );
            });

        }
        else if( termChoice.hasClass('SelSchool') )
        {
            $( "#SubjectHeader").empty();
            $( "#SubjectHeader").append("<strong> Select Subject </strong>");

        	schoolCode = termChoice.attr('name');
        	$( "#SubjectHolder").empty();
        	var url = "{{ config['api_url'] }}/get_subjects?term_code=" + termCode + "&school=" + schoolCode;
            $.getJSON( url, function( jsonData ) {
                var items = [];
                $.each( jsonData, function( key, obj ) {
                    //items.push( "<li id='" + obj.SchoolCode + "'>" + obj.SchoolDescr + "</li>" );
                    items.push( "<div class='TermItem SelSubject' name='" + obj.SubjectCode + "' <p> (" + obj.SubjectShortDescr + ") " + obj.SubjectDescr + " </p></div>"  );
                });

                $( "#SubjectHolder").append( items );
            });

        }
        else if( termChoice.hasClass('SelSubject') )
        {
            $( "#ClassHeader").empty();
            $( "#ClassHeader").append("<strong> Select Class </strong>");

        	subjectCode = termChoice.attr('name');
        	$( "#ClassHolder").empty();
        	var url = "{{ config['api_url'] }}/get_catalog_numbers?term_code=" + termCode + "&school=" + schoolCode + "&subject=" + subjectCode;
            $.getJSON( url, function( jsonData ) {
                var items = [];
                $.each( jsonData, function( key, obj ) {
                    //items.push( "<li id='" + obj.SchoolCode + "'>" + obj.SchoolDescr + "</li>" );
                    items.push( "<div class='TermItem SelClass' name='" + obj.CatalogNumber + "' <p> (" + obj.CatalogNumber + ") " + obj.CourseDescr + " </p></div>"  );
                });

                $( "#ClassHolder").append( items );

                if( items.length <= 0 )
                {
                	$( "#ClassHolder").append( "<p> This subject has no classes this term :( </p>" );
                }
            });
        }

        if( !currentPanel.hasClass('FinalStage') && !$(panelToActivate).is('.active') ){

            numMorePanels = $(panelToActivate).nextAll('.panel').length;

            //animate all previous panels to normal width
            $(panelToActivate).prevAll('.panel').animate({width: "19%"}, 300);

            //animate all the rest of the panels (ones that come after) to small width
            $(panelToActivate).nextAll('.panel').animate({width: "3%"}, 300);
            //animate the main panel to full size for selection
            $(panelToActivate).animate({width: "43%"}, 300);

            for(i = 0; i < numMorePanels; i++)
            {
                $(panelToActivate).animate({width: "+=11.66%"}, 120);
            }
            //no longer active
            $('#accordion .panel').removeClass('active');
            //set active to the selection
            $(panelToActivate).addClass('active');
            //(Depricated)
            activePanel = $(panelToActivate);
         };
    });
});
</script>


{% endblock %}